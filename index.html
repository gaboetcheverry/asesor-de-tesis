<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asesor Integral de Tesis - Sistema Multiagente</title>

    <!-- INICIO: Etiquetas para Vista Previa de Enlace (Open Graph) -->
    <!-- Estas etiquetas le dicen a las redes sociales (Facebook, WhatsApp, LinkedIn) c√≥mo mostrar tu app -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://gaboetcheverry.github.io/asesor-de-tesis/"> <!-- ¬°URL actualizada! -->
    <meta property="og:title" content="Asesor Integral de Tesis - Chatbot Educativo">
    <meta property="og:description" content="Un sistema multiagente de IA para ayudarte con tu investigaci√≥n acad√©mica.">
    <!-- Imagen de vista previa (1200x630px es ideal). Esta es una imagen de ejemplo. -->
    <meta property="og:image" content="https://placehold.co/1200x630/33808D/FFFFFF?text=Asesor%20de%20Tesis%0AIA">
    
    <!-- Etiquetas espec√≠ficas para X (Twitter) -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://gaboetcheverry.github.io/asesor-de-tesis/"> <!-- ¬°URL actualizada! -->
    <meta property="twitter:title" content="Asesor Integral de Tesis - Chatbot Educativo">
    <meta property="twitter:description" content="Un sistema multiagente de IA para ayudarte con tu investigaci√≥n acad√©mica.">
    <meta property="twitter:image" content="https://placehold.co/1200x630/33808D/FFFFFF?text=Asesor%20de%20Tesis%0AIA">
    <!-- FIN: Etiquetas para Vista Previa de Enlace -->


    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);

            --yellow: #FFD700;
            --orange: #FF6B35;
            --orange-dark: #FF8C42;
            --red: #E63946;
            --blue: #457B9D;
            --purple: #9D4EDD;
            --cyan: #06FFF0;

            --color-background: var(--color-cream-50);
            --color-surface: var(--color-white);
            --color-text: var(--color-charcoal-700);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-border: rgba(94, 82, 64, 0.2);

            --font-family-base: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
            --radius-base: 8px;
            --radius-lg: 12px;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(167, 169, 169, 0.7);
                --color-primary: var(--color-teal-300);
                --color-border: rgba(119, 124, 124, 0.3);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-base);
            background-color: var(--color-background);
            color: var(--color-text);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-teal-600) 100%);
            color: white;
            padding: 30px 0;
            box-shadow: var(--shadow-md);
            margin-bottom: 30px;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            text-align: center;
        }

        h1 {
            font-size: 2.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 968px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .sidebar {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            padding: 25px;
            box-shadow: var(--shadow-sm);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .level-selector {
            margin-bottom: 25px;
        }

        .level-selector h3 {
            font-size: 1rem;
            margin-bottom: 15px;
            color: var(--color-text);
        }

        .level-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .level-btn {
            padding: 12px 15px;
            border: 2px solid var(--color-border);
            background: var(--color-surface);
            color: var(--color-text);
            border-radius: var(--radius-base);
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .level-btn:hover {
            border-color: var(--color-primary);
            background: rgba(33, 128, 141, 0.05);
        }

        .level-btn.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        .agent-menu {
            margin-top: 25px;
        }

        .agent-menu h3 {
            font-size: 1rem;
            margin-bottom: 15px;
            color: var(--color-text);
        }

        .agent-item {
            padding: 10px 12px;
            margin-bottom: 8px;
            border-radius: var(--radius-base);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .agent-item:hover {
            background: rgba(33, 128, 141, 0.1);
        }

        .agent-item.active {
            background: var(--color-primary);
            color: white;
        }

        .agent-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--color-gray-300);
        }

        .agent-item.active .agent-indicator {
            background: white;
        }

        .agent-item.working .agent-indicator {
            background: #4ade80;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .main-content {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            padding: 30px;
            box-shadow: var(--shadow-sm);
            min-height: 600px;
        }

        .welcome-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .welcome-screen h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--color-text);
        }

        .welcome-screen p {
            font-size: 1.1rem;
            color: var(--color-text-secondary);
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .category-card {
            background: var(--color-surface);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-base);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .category-card.yellow {
            border-color: var(--yellow);
        }
        .category-card.orange {
            border-color: var(--orange);
        }
        .category-card.orange-dark {
            border-color: var(--orange-dark);
        }
        .category-card.red {
            border-color: var(--red);
        }
        .category-card.blue {
            border-color: var(--blue);
        }
        .category-card.purple {
            border-color: var(--purple);
        }
        .category-card.cyan {
            border-color: var(--cyan);
        }

        .category-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .category-card h4 {
            font-size: 1rem;
            margin-bottom: 10px;
            color: var(--color-text);
        }

        .category-card p {
            font-size: 0.85rem;
            color: var(--color-text-secondary);
        }

        .chat-interface {
            display: none;
        }

        .chat-interface.active {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .chat-header {
            border-bottom: 2px solid var(--color-border);
            padding-bottom: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .agent-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-primary), var(--color-teal-600));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .agent-info h3 {
            font-size: 1.2rem;
            color: var(--color-text);
        }

        .agent-info p {
            font-size: 0.9rem;
            color: var(--color-text-secondary);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px 0;
            max-height: 450px;
        }

        .message {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: var(--radius-base);
            max-width: 85%;
        }

        .message.user {
            background: rgba(33, 128, 141, 0.1);
            margin-left: auto;
        }

        .message.agent {
            background: var(--color-gray-200);
        }
        
        @media (prefers-color-scheme: dark) {
            .message.agent {
                background: var(--color-charcoal-700);
            }
        }

        .message-header {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--color-text);
        }

        .message-content {
            color: var(--color-text);
            line-height: 1.6;
        }
        
        .message-content p, .message-content ul, .message-content li {
            color: var(--color-text);
        }
        
        .message-content ul {
            margin-left: 20px;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .agent-badges {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .agent-badge {
            background: var(--color-primary);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .chat-input-area {
            margin-top: 20px;
            border-top: 2px solid var(--color-border);
            padding-top: 20px;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .quick-action-btn {
            padding: 8px 14px;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .quick-action-btn:hover {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid var(--color-border);
            border-radius: var(--radius-base);
            font-size: 1rem;
            font-family: var(--font-family-base);
            background: var(--color-surface);
            color: var(--color-text);
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .send-btn {
            padding: 12px 25px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius-base);
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .send-btn:hover {
            background: var(--color-primary-hover);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .thinking {
            display: none;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: rgba(33, 128, 141, 0.1);
            border-radius: var(--radius-base);
            margin-bottom: 15px;
        }
        
        @media (prefers-color-scheme: dark) {
            .thinking {
                 background: rgba(50, 184, 198, 0.1);
            }
        }

        .thinking.active {
            display: flex;
        }

        .thinking-dots {
            display: flex;
            gap: 5px;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--color-primary);
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .dot:nth-child(1) {
            animation-delay: -0.32s;
        }
        .dot:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes bounce {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1);
            }
        }

        .grade-badge {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #1a1a1a;
            padding: 20px;
            border-radius: var(--radius-base);
            text-align: center;
            margin-top: 30px;
            box-shadow: var(--shadow-md);
        }

        .grade-badge .highlight {
            background: #1a1a1a;
            color: #FFD700;
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: 700;
            font-size: 1.2rem;
            display: inline-block;
            margin-bottom: 10px;
        }

        .grade-badge p {
            font-weight: 500;
            font-size: 1.05rem;
            line-height: 1.6;
        }

        .signature {
            font-style: italic;
            margin-top: 10px;
            font-size: 0.95rem;
        }

        .progress-dashboard {
            background: linear-gradient(135deg, rgba(33, 128, 141, 0.1) 0%, rgba(33, 128, 141, 0.05) 100%);
            border-radius: var(--radius-base);
            padding: 20px;
            margin-bottom: 25px;
        }

        .progress-dashboard h3 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: var(--color-text);
        }

        .progress-bar-container {
            background: var(--color-surface);
            border-radius: 20px;
            height: 30px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-bar {
            background: linear-gradient(90deg, var(--color-primary) 0%, var(--color-teal-600) 100%);
            height: 100%;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.85rem;
            transition: width 0.5s ease;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.95rem;
            color: var(--color-text);
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--color-border);
            border-radius: var(--radius-base);
            font-size: 1rem;
            font-family: var(--font-family-base);
            background: var(--color-surface);
            color: var(--color-text);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        select.form-control {
            cursor: pointer;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius-base);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
        }

        .hidden {
            display: none;
        }

        .diagnostic-form {
            max-width: 600px;
            margin: 0 auto;
        }

        .resources-section {
            margin-top: 30px;
            padding: 20px;
            background: rgba(33, 128, 141, 0.05);
            border-radius: var(--radius-base);
        }

        .resources-section h4 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: var(--color-text);
        }

        .resource-list {
            list-style: none;
        }

        .resource-item {
            padding: 10px;
            margin-bottom: 8px;
            background: var(--color-surface);
            border-radius: var(--radius-base);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .resource-item:hover {
            background: rgba(33, 128, 141, 0.1);
        }
        
        /* Estilos para el Modal de Alerta Personalizado */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: var(--color-surface);
            padding: 30px;
            border-radius: var(--radius-lg);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 450px;
            text-align: center;
        }
        
        .modal-content h3 {
            margin-bottom: 15px;
            color: var(--color-text);
        }
        
        .modal-content p {
            margin-bottom: 25px;
            color: var(--color-text-secondary);
        }
        
        .modal-close-btn {
            padding: 10px 20px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius-base);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .modal-close-btn:hover {
            background: var(--color-primary-hover);
        }
        
        .modal-overlay.active {
            display: flex;
        }

    </style>
</head>
<body>

    <!-- Modal de Alerta Personalizado -->
    <div id="customAlert" class="modal-overlay">
        <div class="modal-content">
            <h3 id="customAlertTitle">Alerta</h3>
            <p id="customAlertMessage">Este es un mensaje de alerta.</p>
            <button class="modal-close-btn" onclick="closeCustomAlert()">Entendido</button>
        </div>
    </div>

    <header>
        <div class="header-content">
            <h1>üéì Asesor Integral de Tesis</h1>
            <p class="subtitle">Sistema Multiagente de IA para Investigaci√≥n Acad√©mica 2025</p>
        </div>
    </header>

    <div class="container">
        <div class="main-grid">
            <aside class="sidebar">
                <div class="level-selector">
                    <h3>Nivel Acad√©mico</h3>
                    <div class="level-buttons">
                        <button class="level-btn" data-level="licenciatura">
                            üéì Licenciatura
                        </button>
                        <button class="level-btn" data-level="maestria">
                            üìö Maestr√≠a
                        </button>
                        <button class="level-btn" data-level="doctorado">
                            üî¨ Doctorado
                        </button>
                    </div>
                </div>
                <div class="agent-menu">
                    <h3>Agentes Especializados</h3>
                    <div class="agent-item" data-agent="coordinator">
                        <span class="agent-indicator"></span>
                        <span>Coordinador</span>
                    </div>
                    <div class="agent-item" data-agent="writing">
                        <span class="agent-indicator"></span>
                        <span>Escritura Acad√©mica</span>
                    </div>
                    <div class="agent-item" data-agent="literature">
                        <span class="agent-indicator"></span>
                        <span>B√∫squeda Literatura</span>
                    </div>
                    <div class="agent-item" data-agent="quantitative">
                        <span class="agent-indicator"></span>
                        <span>An√°lisis Cuantitativo</span>
                    </div>
                    <div class="agent-item" data-agent="qualitative">
                        <span class="agent-indicator"></span>
                        <span>An√°lisis Cualitativo</span>
                    </div>
                    <div class="agent-item" data-agent="grammar">
                        <span class="agent-indicator"></span>
                        <span>Gram√°tica y Estilo</span>
                    </div>
                    <div class="agent-item" data-agent="citations">
                        <span class="agent-indicator"></span>
                        <span>Citas y Referencias</span>
                    </div>
                    <div class="agent-item" data-agent="visuals">
                        <span class="agent-indicator"></span>
                        <span>Ilustraciones</span>
                    </div>
                </div>
            </aside>

            <main class="main-content">
                <!-- Welcome Screen -->
                <div id="welcomeScreen" class="welcome-screen">
                    <h2>¬°Bienvenido al Sistema de Asesor√≠a en Investigaci√≥n!</h2>
                    <p>Soy tu coordinador de investigaci√≥n. Te ayudar√© a desarrollar tu proyecto con el apoyo de 7 agentes especializados.</p>

                    <div class="diagnostic-form">
                        <div class="form-group">
                            <label class="form-label">¬øQu√© nivel acad√©mico cursas?</label>
                            <select class="form-control" id="academicLevel">
                                <option value="">Selecciona tu nivel</option>
                                <option value="licenciatura">Licenciatura</option>
                                <option value="maestria">Maestr√≠a</option>
                                <option value="doctorado">Doctorado</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">¬øCu√°l es tu disciplina o campo de estudio?</label>
                            <input type="text" class="form-control" id="discipline" placeholder="Ej: Psicolog√≠a, Ingenier√≠a, Educaci√≥n...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">¬øEn qu√© fase est√°s?</label>
                            <select class="form-control" id="researchPhase">
                                <option value="">Selecciona la fase</option>
                                <option value="idea">Idea inicial</option>
                                <option value="protocolo">Desarrollo de protocolo</option>
                                <option value="recoleccion">Recolecci√≥n de datos</option>
                                <option value="analisis">An√°lisis de datos</option>
                                <option value="escritura">Escritura de tesis</option>
                                <option value="revision">Revisi√≥n final</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">¬øCu√°l es tu necesidad m√°s urgente hoy?</label>
                            <input type="text" class="form-control" id="urgentNeed" placeholder="Describe brevemente...">
                        </div>
                        <button class="btn btn-primary" onclick="startDiagnosis()">Comenzar Asesor√≠a</button>
                    </div>

                    <p style="margin-top: 50px; font-size: 1rem; color: var(--color-text-secondary);">O haz clic en una categor√≠a para enfocar tu necesidad:</p>
                    <div class="category-grid" style="margin-top: 20px;">
                        <div class="category-card yellow" onclick="selectCategory('Modelos de Lenguaje (ChatGPT, Gemini, Claude)')">
                            <div class="category-icon">‚úçÔ∏è</div>
                            <h4>Modelos de Lenguaje</h4>
                            <p>ChatGPT, Gemini, Claude</p>
                        </div>
                        <div class="category-card orange" onclick="selectCategory('B√∫squeda de Literatura (Elicit, Consensus, Research Rabbit)')">
                            <div class="category-icon">üìö</div>
                            <h4>B√∫squeda de Literatura</h4>
                            <p>Elicit, Consensus, Research Rabbit</p>
                        </div>
                        <div class="category-card orange-dark" onclick="selectCategory('Datos Cuantitativos (Julius, Columns.ai, DataLab)')">
                            <div class="category-icon">üìä</div>
                            <h4>Datos Cuantitativos</h4>
                            <p>Julius, Columns.ai, DataLab</p>
                        </div>
                        <div class="category-card red" onclick="selectCategory('Datos Cualitativos (Marvin, Otter.ai, Notably)')">
                            <div class="category-icon">üí¨</div>
                            <h4>Datos Cualitativos</h4>
                            <p>Marvin, Otter.ai, Notably</p>
                        </div>
                        <div class="category-card blue" onclick="selectCategory('Gram√°tica y Parafraseo (Grammarly, QuillBot, Wordtune)')">
                            <div class="category-icon">‚úèÔ∏è</div>
                            <h4>Gram√°tica y Parafraseo</h4>
                            <p>Grammarly, QuillBot, Wordtune</p>
                        </div>
                        <div class="category-card purple" onclick="selectCategory('Citas y Referencias (Zotero, Mendeley, Citavi)')">
                            <div class="category-icon">üìñ</div>
                            <h4>Citas y Referencias</h4>
                            <p>Zotero, Mendeley, Citavi</p>
                        </div>
                        <div class="category-card cyan" onclick="selectCategory('Ilustraciones (Canva, Tome, Napkin)')">
                            <div class="category-icon">üé®</div>
                            <h4>Ilustraciones</h4>
                            <p>Canva, Tome, Napkin</p>
                        </div>
                    </div>
                </div>

                <!-- Chat Interface -->
                <div id="chatInterface" class="chat-interface">
                    <div class="progress-dashboard">
                        <h3>Progreso del Proyecto</h3>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="progressBar" style="width: 0%;">0%</div>
                        </div>
                        <p style="font-size: 0.9rem; color: var(--color-text-secondary); margin-top: 5px;">
                            Fase actual: <strong id="currentPhase">Inicio</strong>
                        </p>
                    </div>

                    <div class="chat-header">
                        <div class="agent-avatar" id="agentAvatar">C</div>
                        <div class="agent-info">
                            <h3 id="agentName">Coordinador</h3>
                            <p id="agentRole">Director de Tesis Virtual</p>
                        </div>
                    </div>

                    <div class="thinking">
                        <div class="thinking-dots">
                            <div class="dot"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                        </div>
                        <span>El agente est√° procesando tu consulta...</span>
                    </div>

                    <div class="chat-messages" id="chatMessages">
                        <!-- Messages will be added here dynamically -->
                    </div>

                    <div class="chat-input-area">
                        <div class="quick-actions">
                            <button class="quick-action-btn" onclick="quickAction('review')">
                                üìù Revisar mi redacci√≥n
                            </button>
                            <button class="quick-action-btn" onclick="quickAction('search')">
                                üîç Buscar literatura
                            </button>
                            <button class="quick-action-btn" onclick="quickAction('analyze')">
                                üìä Analizar datos
                            </button>
                            <button class="quick-action-btn" onclick="quickAction('format')">
                                ‚úèÔ∏è Corregir formato
                            </button>
                            <button class="quick-action-btn" onclick="quickAction('references')">
                                üìñ Formatear referencias
                            </button>
                            <button class="quick-action-btn" onclick="quickAction('visual')">
                                üé® Crear visual
                            </button>
                        </div>
                        <div class="input-group">
                            <input type="text" class="chat-input" id="userInput" placeholder="Escribe tu consulta aqu√≠..." onkeypress="handleKeyPress(event)">
                            <button class="send-btn" onclick="sendMessage()">Enviar</button>
                        </div>
                    </div>
                </div>

                <div class="grade-badge">
                    <span class="highlight">GRADO</span>
                    <p>Comenta si quieres acelerar tu proyecto de manera √©tica y empezar el nuevo a√±o con una tesis aprobada.</p>
                    <div class="signature">- Tu Asesor Virtual de Investigaci√≥n</div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // --- INICIO: Alertas Personalizadas ---
        function showCustomAlert(title, message) {
            document.getElementById('customAlertTitle').textContent = title;
            document.getElementById('customAlertMessage').textContent = message;
            document.getElementById('customAlert').classList.add('active');
        }

        function closeCustomAlert() {
            document.getElementById('customAlert').classList.remove('active');
        }
        // --- FIN: Alertas Personalizadas ---


        // Estado global de la aplicaci√≥n
        const appState = {
            currentLevel: '',
            discipline: '',
            phase: '',
            urgentNeed: '',
            currentAgent: 'coordinator',
            agentLocked: false, // Para forzar agente en la siguiente consulta
            progress: 0,
            conversationHistory: []
        };

        // Configuraci√≥n de agentes
        const agents = {
            coordinator: {
                name: 'Coordinador',
                role: 'Director de Tesis Virtual',
                avatar: 'C',
                color: 'var(--color-primary)',
                prompt: 'Eres el Coordinador, un director de tesis virtual. Tu tarea es enrutar las consultas al agente correcto o responder a preguntas generales sobre el proceso de investigaci√≥n. Eres amigable, organizado y motivador.'
            },
            writing: {
                name: 'Especialista en Escritura',
                role: 'Modelos de Lenguaje y Redacci√≥n Acad√©mica',
                avatar: '‚úçÔ∏è',
                color: 'var(--yellow)',
                prompt: 'Eres un Especialista en Escritura Acad√©mica. Ayudas a los estudiantes a estructurar argumentos, redactar cap√≠tulos (introducci√≥n, metodolog√≠a, etc.), mejorar la claridad y usar modelos de lenguaje (como ChatGPT, Gemini, Claude) de forma √©tica. Adaptas tu consejo al nivel acad√©mico (licenciatura, maestr√≠a, doctorado) y la fase (idea, escritura, etc.).'
            },
            literature: {
                name: 'Especialista en Literatura',
                role: 'B√∫squeda y Revisi√≥n Sistem√°tica',
                avatar: 'üìö',
                color: 'var(--orange)',
                prompt: 'Eres un Especialista en Revisi√≥n de Literatura. Gu√≠as a los estudiantes para encontrar, evaluar y sintetizar art√≠culos acad√©micos. Recomiendas bases de datos (Scopus, SciELO) y herramientas (Elicit, Consensus, Research Rabbit) para crear un estado del arte s√≥lido.'
            },
            quantitative: {
                name: 'Analista Cuantitativo',
                role: 'Estad√≠stica y Datos Num√©ricos',
                avatar: 'üìä',
                color: 'var(--orange-dark)',
                prompt: 'Eres un Analista Cuantitativo. Ayudas con dise√±o metodol√≥gico (encuestas, experimentos), an√°lisis estad√≠stico (t-test, ANOVA, regresi√≥n), y el uso de software (SPSS, R, Python) y herramientas de IA (Julius, DataLab) para interpretar datos num√©ricos.'
            },
            qualitative: {
                name: 'Analista Cualitativo',
                role: 'Investigaci√≥n Cualitativa',
                avatar: 'üí¨',
                color: 'var(--red)',
                prompt: 'Eres un Analista Cualitativo. Asesoras en m√©todos como entrevistas, grupos focales y an√°lisis de contenido. Gu√≠as en el proceso de codificaci√≥n (abierta, axial) y el uso de software (NVivo) o herramientas de IA (Marvin, Otter.ai) para encontrar patrones en datos textuales.'
            },
            grammar: {
                name: 'Corrector',
                role: 'Gram√°tica y Estilo Acad√©mico',
                avatar: '‚úèÔ∏è',
                color: 'var(--blue)',
                prompt: 'Eres un Corrector de Estilo Acad√©mico. Ayudas a mejorar la gram√°tica, puntuaci√≥n, ortograf√≠a y el tono formal. Recomiendas herramientas como Grammarly, QuillBot o Wordtune para pulir el texto final y asegurar que sea claro y profesional.'
            },
            citations: {
                name: 'Gestor Bibliogr√°fico',
                role: 'Citas y Referencias',
                avatar: 'üìñ',
                color: 'var(--purple)',
                prompt: 'Eres un Gestor Bibliogr√°fico. Eres experto en normas de citaci√≥n (APA, MLA, Chicago). Ayudas a formatear citas en el texto y la lista de referencias. Recomiendas gestores como Zotero, Mendeley o Citavi para organizar fuentes y evitar el plagio.'
            },
            visuals: {
                name: 'Dise√±ador Visual',
                role: 'Ilustraciones y Gr√°ficos',
                avatar: 'üé®',
                color: 'var(--cyan)',
                prompt: 'Eres un Dise√±ador Visual Acad√©mico. Ayudas a crear gr√°ficos, diagramas, modelos conceptuales e infograf√≠as para comunicar resultados de forma clara. Recomiendas herramientas como Canva, Tome o Draw.io para mejorar el impacto visual de la tesis.'
            }
        };

        // --- INICIO: Configuraci√≥n de API de Gemini ---
        
        // ADVERTENCIA DE SEGURIDAD: 
        // ¬°No uses una API Key real aqu√≠ en producci√≥n! 
        // Tu clave ser√° visible para cualquier visitante del sitio.
        // √ösala solo para pruebas locales.
        const GEMINI_API_KEY = "AIzaSyAzD9OqLEpwPhx2LBf0nEmBJJo49cEwQ4Y"; 
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${GEMINI_API_KEY}`;
        
        // --- FIN DE CONFIGURACI√ìN DE API ---

        /**
         * Funci√≥n gen√©rica para llamar a la API de Gemini
         */
        async function callGeminiAPI(payload) {
            const sendBtn = document.querySelector('.send-btn');
            sendBtn.disabled = true; // Deshabilitar bot√≥n
            showThinking();

            try {
                const response = await fetch(GEMINI_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });

                if (!response.ok) {
                    throw new Error(`Error de API: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                
                // Extraer texto de la respuesta
                if (data.candidates && data.candidates[0].content && data.candidates[0].content.parts[0]) {
                    return data.candidates[0].content.parts[0].text;
                } else {
                    // Manejar respuesta sin contenido (ej. safety settings)
                    console.warn('Respuesta de API recibida pero sin contenido:', data);
                    return null; // Devolver null para que sea manejado
                }

            } catch (error) {
                console.error("Error al llamar a Gemini API:", error);
                hideThinking();
                addMessage('agent', `<p>üî¥ **Error de Sistema**</p><p>Hubo un problema al conectar con la IA. Es posible que la API Key no sea v√°lida o se haya alcanzado el l√≠mite de cuota. Revisa la consola para m√°s detalles.</p>`);
                return null; // Devolver null en caso de error
            } finally {
                sendBtn.disabled = false; // Rehabilitar bot√≥n
                hideThinking();
            }
        }

        /**
         * Llama a la IA para determinar a qu√© agente enrutar la consulta.
         */
        async function getAgentRouting(message) {
            const agentList = Object.keys(agents).map(key => `${key}: ${agents[key].role}`).join('\n');
            
            const systemPrompt = `Tu tarea es actuar como un enrutador inteligente. Analiza la consulta del usuario y decide cu√°l de los siguientes agentes es el m√°s adecuado para responder.

Agentes disponibles:
${agentList}

Consulta del usuario: "${message}"

Responde SOLAMENTE con el ID del agente (ej: "writing", "quantitative", "coordinator") en formato JSON, as√≠:
{ "agent": "ID_DEL_AGENTE" }`;

            const payload = {
                contents: [{ parts: [{ text: systemPrompt }] }],
                generationConfig: {
                    responseMimeType: "application/json",
                }
            };
            
            const responseText = await callGeminiAPI(payload);

            if (!responseText) return 'coordinator'; // Fallback

            try {
                // El texto ya es el JSON extra√≠do
                const responseJson = JSON.parse(responseText);
                const agentId = responseJson.agent;
                
                if (agents[agentId]) {
                    console.log("Enrutando a:", agentId);
                    return agentId;
                } else {
                    console.warn(`IA sugiri√≥ agente desconocido: ${agentId}. Usando coordinador.`);
                    return 'coordinator'; // Fallback si el agente no existe
                }
            } catch (error) {
                console.error("Error al parsear JSON de enrutamiento:", error, "Respuesta recibida:", responseText);
                // Si la IA no devuelve JSON, sino texto, se rompe aqu√≠.
                // Fallback seguro al coordinador.
                return 'coordinator';
            }
        }

        /**
         * Llama a la IA para generar una respuesta desde la perspectiva del agente.
         */
        async function getAgentResponse(message, agent, state) {
            const context = `
Nivel Acad√©mico: ${state.currentLevel}
Disciplina: ${state.discipline}
Fase de Investigaci√≥n: ${state.phase}
`;
            
            const systemPrompt = `
${agent.prompt}

Tu contexto de estudiante es:
${context}

Responde a la siguiente consulta del usuario de forma √∫til, clara y profesional.
Tu respuesta DEBE estar formateada en HTML simple (usa <p>, <b>, <ul>, <li>).

Consulta del usuario:
"${message}"
`;

            const payload = {
                contents: [{ parts: [{ text: systemPrompt }] }],
                generationConfig: {
                    // Omitimos responseMimeType: "application/json" para obtener HTML/texto
                }
            };
            
            const responseText = await callGeminiAPI(payload);

            if (!responseText) {
                return '<p>Lo siento, no pude procesar esa respuesta. ¬øPodr√≠as reformular tu pregunta?</p>';
            }
            
            return responseText; // Devuelve el texto (HTML) generado
        }


        // --- FIN L√ìGICA DE IA ---


        // Inicializar nivel acad√©mico
        document.querySelectorAll('.level-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                appState.currentLevel = this.dataset.level;
                document.getElementById('academicLevel').value = this.dataset.level;
            });
        });

        // Inicializar men√∫ de agentes
        document.querySelectorAll('.agent-item').forEach(item => {
            item.addEventListener('click', function() {
                if (document.getElementById('chatInterface').classList.contains('active')) {
                    selectAgent(this.dataset.agent);
                }
            });
        });

        function selectAgent(agentId, silent = false) {
            document.querySelectorAll('.agent-item').forEach(item => item.classList.remove('active'));
            document.querySelector(`[data-agent="${agentId}"]`).classList.add('active');
            
            appState.currentAgent = agentId;
            const agent = agents[agentId];
            
            document.getElementById('agentAvatar').textContent = agent.avatar;
            document.getElementById('agentName').textContent = agent.name;
            document.getElementById('agentRole').textContent = agent.role;
            
            if (!silent) { // Solo saluda si no es un cambio silencioso
                // Se envuelve el saludo en etiquetas <p> para HTML v√°lido
                addMessage('agent', `<p>¬°Hola! Soy ${agent.name}, ${agent.role}. ¬øEn qu√© puedo ayudarte hoy?</p>`);
                // Se bloquea el agente para la siguiente consulta
                appState.agentLocked = true;
            }
        }

        function selectCategory(categoryDescription) {
            // Pone la descripci√≥n de la categor√≠a en el campo de necesidad urgente
            document.getElementById('urgentNeed').value = categoryDescription;
            showCustomAlert('Necesidad Enfocada', `Has seleccionado "${categoryDescription}". Por favor, completa el resto del formulario para comenzar.`);
            document.getElementById('urgentNeed').focus();
        }

        function startDiagnosis() {
            const level = document.getElementById('academicLevel').value;
            const discipline = document.getElementById('discipline').value;
            const phase = document.getElementById('researchPhase').value;
            const urgentNeed = document.getElementById('urgentNeed').value;

            if (!level || !discipline || !phase || !urgentNeed) {
                showCustomAlert('Campos Incompletos', 'Por favor, completa todos los campos del diagn√≥stico para comenzar.');
                return;
            }

            appState.currentLevel = level;
            appState.discipline = discipline;
            appState.phase = phase;
            appState.urgentNeed = urgentNeed;

            // Actualizar progreso
            const progressMap = {
                'idea': 10,
                'protocolo': 25,
                'recoleccion': 50,
                'analisis': 70,
                'escritura': 85,
                'revision': 95
            };
            appState.progress = progressMap[phase] || 0;

            // Actualizar UI
            document.getElementById('progressBar').style.width = appState.progress + '%';
            document.getElementById('progressBar').textContent = appState.progress + '%';
            document.getElementById('currentPhase').textContent = document.querySelector(`#researchPhase option[value="${phase}"]`).text;

            // Cambiar a interfaz de chat
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('chatInterface').classList.add('active');

            // Seleccionar nivel en sidebar
            document.querySelectorAll('.level-btn').forEach(btn => {
                if (btn.dataset.level === level) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            // Activar coordinador
            selectAgent('coordinator', true); // Saludo silencioso

            // Mensaje de bienvenida personalizado
            setTimeout(() => {
                const levelLabels = {
                    'licenciatura': 'Licenciatura',
                    'maestria': 'Maestr√≠a',
                    'doctorado': 'Doctorado'
                };
                const phaseLabels = {
                    'idea': 'idea inicial',
                    'protocolo': 'desarrollo de protocolo',
                    'recoleccion': 'recolecci√≥n de datos',
                    'analisis': 'an√°lisis de datos',
                    'escritura': 'escritura de tesis',
                    'revision': 'revisi√≥n final'
                };
                
                const welcomeMsg = `
<p>¬°Excelente! Veo que est√°s cursando ${levelLabels[level]} en ${discipline}, en la fase de ${phaseLabels[phase]}.</p>
<p>Tu necesidad urgente es: "${urgentNeed}".</p>
<p>Estoy aqu√≠ para ayudarte a avanzar. ¬øCu√°l es tu primera consulta?</p>
`;
                
                addMessage('agent', welcomeMsg, ['Coordinador']);
            }, 500);
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();

            if (!message) return;

            addMessage('user', message);
            input.value = '';

            // Mostrar "pensando" inmediatamente
            showThinking(); 
            
            // --- L√≥gica de IA As√≠ncrona ---
            await processMessage(message);
        }

        async function processMessage(message) {
            let response = '';
            let agent; // Para guardar el objeto del agente
            let agentId; // Para guardar el ID del agente

            try {
                // 1. Comprobar si el agente est√° "bloqueado" por selecci√≥n manual
                if (appState.agentLocked) {
                    agentId = appState.currentAgent; // Usar el agente ya seleccionado
                    appState.agentLocked = false; // Desbloquear despu√©s de este mensaje
                    agent = agents[agentId];
                    console.log('Agente bloqueado manualmente:', agentId);
                } else {
                    // 2. Si no est√° bloqueado, llamar a la IA para enrutar
                    agentId = await getAgentRouting(message);
                    if (agentId && agents[agentId]) {
                        agent = agents[agentId];
                        // Si la IA sugiere un agente diferente, cambiar a √©l
                        if (appState.currentAgent !== agentId) {
                            selectAgent(agentId, true); // true = cambio silencioso, sin saludo
                        }
                    } else {
                        agent = agents[appState.currentAgent]; // Usar el agente actual si la IA falla
                    }
                }

                // 3. Obtener la RESPUESTA GENERADA POR IA
                response = await getAgentResponse(message, agent, appState);
                
                hideThinking(); // Ocultar "pensando"
                
                if (response) {
                    addMessage('agent', response, [agent.name]);
                } else {
                    // Esto maneja si callGeminiAPI devuelve null (por error o filtro)
                    addMessage('agent', '<p>Hubo un problema al generar la respuesta. Por favor, int√©ntalo de nuevo.</p>', [agent.name]);
                }

            } catch (error) {
                console.error("Error en processMessage:", error);
                hideThinking();
                addMessage('agent', `<p>üî¥ **Error Inesperado**</p><p>Ha ocurrido un error al procesar tu solicitud. Por favor, revisa la consola e int√©ntalo de nuevo.</p>`);
            }
        }

        function quickAction(action) {
            const actions = {
                'review': '¬øPodr√≠as revisar mi redacci√≥n del cap√≠tulo de metodolog√≠a?',
                'search': 'Necesito buscar literatura reciente sobre mi tema de investigaci√≥n',
                'analyze': '¬øQu√© prueba estad√≠stica debo usar para mis datos?',
                'format': 'Ay√∫dame a corregir el estilo acad√©mico de mi introducci√≥n',
                'references': 'Necesito formatear mis referencias en APA 7',
                'visual': 'Quiero crear un diagrama metodol√≥gico para mi tesis'
            };

            document.getElementById('userInput').value = actions[action];
            sendMessage();
        }

        function addMessage(type, content, agentBadges = []) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;

            const header = type === 'user' ? 'T√∫' : agents[appState.currentAgent].name;

            let badgesHTML = '';
            if (agentBadges.length > 0) {
                badgesHTML = '<div class="agent-badges">' +
                    agentBadges.map(agent => `<span class="agent-badge">Consultado: ${agent}</span>`).join('') +
                    '</div>';
            }

            // Si el contenido no es HTML (usuario), escaparlo. Si es IA, confiar en que es HTML.
            let contentHTML = '';
            if (type === 'user') {
                // Escapar HTML simple para mensajes de usuario
                const tempDiv = document.createElement('div');
                tempDiv.innerText = content;
                contentHTML = `<p>${tempDiv.innerHTML.replace(/\n/g, '<br>')}</p>`;
            } else {
                // Confiar en que 'content' es HTML v√°lido de la IA
                contentHTML = content;
            }

            messageDiv.innerHTML = `
                <div class="message-header">${header}</div>
                <div class="message-content">${contentHTML}</div>
                ${badgesHTML}
            `;

            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            appState.conversationHistory.push({ type, content, timestamp: new Date() });
        }

        function showThinking() {
            document.querySelector('.thinking').classList.add('active');
            document.querySelectorAll('.agent-item').forEach(item => item.classList.remove('working'));
            document.querySelector(`[data-agent="${appState.currentAgent}"]`).classList.add('working');
        }

        function hideThinking() {
            document.querySelector('.thinking').classList.remove('active');
            document.querySelectorAll('.agent-item').forEach(item => item.classList.remove('working'));
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Mensaje inicial del sistema
        window.addEventListener('load', () => {
            console.log('Sistema Multiagente de Asesor√≠a en Investigaci√≥n - v1.0');
            console.log('7 Agentes Especializados + Coordinador');
            console.log('Adaptado para: Licenciatura, Maestr√≠a y Doctorado');
        });
    </script>
</body>
</html>
